import{r as ne,g as N,a as re,b as le,c as V,d as ie,e as R,s as oe,m as se}from"./247_1646096953790.6e986bed.js";import{c as ce}from"./114_1646096953790.1e8578cd.js";import{a as ue,C as de}from"./205_1646096953790.8ebee816.js";import{u as fe}from"./245_1646096953790.6fedd3c5.js";import{u as me}from"./217_1646096953790.c66fba23.js";import{I as M}from"./51_1646096953790.645d8535.js";import{C as ge}from"./25_1646096953790.a8681b8e.js";import{a as be,f as he}from"./210_1646096953790.16bc3f07.js";import{d as ve,a as y,p as ye,w as Ce,n as C,g as Ie,c as l,m as Se,t as xe}from"./99_1646096953790.2e68aba8.js";import{p as _,r as ke}from"./208_1646096953790.221879eb.js";import{c as we}from"./209_1646096953790.2b450392.js";import{n as E,a as I,b as Ve,u as Me}from"./207_1646096953790.c00e6cff.js";import{e as Te}from"./206_1646096953790.777a9663.js";import{r as Ee,a as O}from"./221_1646096953790.4fbcc151.js";import{F as Pe}from"./211_1646096953790.cdacef51.js";import{i as T}from"./212_1646096953790.a8c154ec.js";const[Fe,s]=we("field"),Le={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:E,formatter:Function,clearIcon:I("clear"),modelValue:Ve(""),inputAlign:String,placeholder:String,autocomplete:String,errorMessage:String,clearTrigger:I("focus"),formatTrigger:I("onChange"),error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null}},Be=Te({},ce,Le,{rows:E,type:I("text"),rules:Array,autosize:[Boolean,Object],labelWidth:E,labelClass:Me,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var He=ve({name:Fe,props:Be,emits:["blur","focus","clear","keypress","click-input","click-left-icon","click-right-icon","update:modelValue"],setup(t,{emit:d,slots:i}){const S=fe(),r=Ee({focused:!1,validateFailed:!1,validateMessage:""}),f=O(),x=O(),{parent:c}=ue(Pe),m=()=>{var e;return String((e=t.modelValue)!=null?e:"")},u=e=>{if(T(t[e]))return t[e];if(c&&T(c.props[e]))return c.props[e]},z=y(()=>{const e=u("readonly");if(t.clearable&&!e){const a=m()!=="",n=t.clearTrigger==="always"||t.clearTrigger==="focus"&&r.focused;return a&&n}return!1}),P=y(()=>x.value&&i.input?x.value():t.modelValue),D=e=>e.reduce((a,n)=>a.then(()=>{if(r.validateFailed)return;let{value:o}=P;if(n.formatter&&(o=n.formatter(o,n)),!ne(o,n)){r.validateFailed=!0,r.validateMessage=N(o,n);return}if(n.validator)return re(o,n).then(v=>{v&&typeof v=="string"?(r.validateFailed=!0,r.validateMessage=v):v===!1&&(r.validateFailed=!0,r.validateMessage=N(o,n))})}),Promise.resolve()),g=()=>{r.validateFailed&&(r.validateFailed=!1,r.validateMessage="")},F=(e=t.rules)=>new Promise(a=>{g(),e?D(e).then(()=>{r.validateFailed?a({name:t.name,message:r.validateMessage}):a()}):a()}),k=e=>{if(c&&t.rules){const a=c.props.validateTrigger===e,n=t.rules.filter(o=>o.trigger?o.trigger===e:a);n.length&&F(n)}},W=e=>{const{maxlength:a}=t;if(T(a)&&V(e)>a){const n=m();return n&&V(n)===+a?n:ie(e,+a)}return e},b=(e,a="onChange")=>{if(e=W(e),t.type==="number"||t.type==="digit"){const n=t.type==="number";e=he(e,n,n)}t.formatter&&a===t.formatTrigger&&(e=t.formatter(e)),f.value&&f.value.value!==e&&(f.value.value=e),e!==t.modelValue&&d("update:modelValue",e)},$=e=>{e.target.composing||b(e.target.value)},w=()=>{var e;return(e=f.value)==null?void 0:e.blur()},K=()=>{var e;return(e=f.value)==null?void 0:e.focus()},h=()=>{const e=f.value;t.type==="textarea"&&t.autosize&&e&&le(e,t.autosize)},j=e=>{r.focused=!0,d("focus",e),C(h),u("readonly")&&w()},q=e=>{u("readonly")||(r.focused=!1,b(m(),"onBlur"),d("blur",e),k("onBlur"),C(h),ke())},L=e=>d("click-input",e),U=e=>d("click-left-icon",e),Y=e=>d("click-right-icon",e),J=e=>{_(e),d("update:modelValue",""),d("clear",e)},B=y(()=>{if(typeof t.error=="boolean")return t.error;if(c&&c.props.showError&&r.validateFailed)return!0}),G=y(()=>{const e=u("labelWidth");if(e)return{width:be(e)}}),H=e=>{e.keyCode===13&&(!(c&&c.props.submitOnEnter)&&t.type!=="textarea"&&_(e),t.type==="search"&&w()),d("keypress",e)},A=()=>t.id||`${S}-input`,Q=()=>{const e=s("control",[u("inputAlign"),{error:B.value,custom:!!i.input,"min-height":t.type==="textarea"&&!t.autosize}]);if(i.input)return l("div",{class:e,onClick:L},[i.input()]);const a={id:A(),ref:f,name:t.name,rows:t.rows!==void 0?+t.rows:void 0,class:e,value:t.modelValue,disabled:u("disabled"),readonly:u("readonly"),autofocus:t.autofocus,placeholder:t.placeholder,autocomplete:t.autocomplete,"aria-labelledby":t.label?`${S}-label`:void 0,onBlur:q,onFocus:j,onInput:$,onClick:L,onChange:R,onKeypress:H,onCompositionend:R,onCompositionstart:oe};return t.type==="textarea"?l("textarea",a,null):l("input",Se(se(t.type),a),null)},X=()=>{const e=i["left-icon"];if(t.leftIcon||e)return l("div",{class:s("left-icon"),onClick:U},[e?e():l(M,{name:t.leftIcon,classPrefix:t.iconPrefix},null)])},Z=()=>{const e=i["right-icon"];if(t.rightIcon||e)return l("div",{class:s("right-icon"),onClick:Y},[e?e():l(M,{name:t.rightIcon,classPrefix:t.iconPrefix},null)])},p=()=>{if(t.showWordLimit&&t.maxlength){const e=V(m());return l("div",{class:s("word-limit")},[l("span",{class:s("word-num")},[e]),xe("/"),t.maxlength])}},ee=()=>{if(c&&c.props.showErrorMessage===!1)return;const e=t.errorMessage||r.validateMessage;if(e){const a=i["error-message"],n=u("errorMessageAlign");return l("div",{class:s("error-message",n)},[a?a({message:e}):e])}},te=()=>{const e=u("colon")?":":"";if(i.label)return[i.label(),e];if(t.label)return l("label",{id:`${S}-label`,for:A()},[t.label+e])},ae=()=>[l("div",{class:s("body")},[Q(),z.value&&l(M,{name:t.clearIcon,class:s("clear"),onTouchstart:J},null),Z(),i.button&&l("div",{class:s("button")},[i.button()])]),p(),ee()];return me({blur:w,focus:K,validate:F,formValue:P,resetValidation:g}),ye(de,{customValue:x,resetValidation:g,validateWithTrigger:k}),Ce(()=>t.modelValue,()=>{b(m()),g(),k("onChange"),C(h)}),Ie(()=>{b(m(),t.formatTrigger),C(h)}),()=>{const e=u("disabled"),a=u("labelAlign"),n=te(),o=X();return l(ge,{size:t.size,icon:t.leftIcon,class:s({error:B.value,disabled:e,[`label-${a}`]:a}),center:t.center,border:t.border,isLink:t.isLink,clickable:t.clickable,titleStyle:G.value,valueClass:s("value"),titleClass:[s("label",[a,{required:t.required}]),t.labelClass],arrowDirection:t.arrowDirection},{icon:o?()=>o:null,title:n?()=>n:null,value:ae,extra:i.extra})}}});export{Le as f,He as s};
